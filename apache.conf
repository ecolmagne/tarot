# Configuration Apache pour le jeu de Tarot
# À placer dans /etc/apache2/sites-available/tarot-game.conf

<VirtualHost *:80>
    ServerName votre-domaine.com
    ServerAlias www.votre-domaine.com
    ServerAdmin admin@votre-domaine.com

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/tarot-game-error.log
    CustomLog ${APACHE_LOG_DIR}/tarot-game-access.log combined

    # Proxy pour Node.js
    ProxyPreserveHost On
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/

    # Support WebSocket pour Socket.io
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*)           ws://localhost:3000/$1 [P,L]
    RewriteCond %{HTTP:Upgrade} !=websocket [NC]
    RewriteRule /(.*)           http://localhost:3000/$1 [P,L]

    # Headers de proxy
    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>

    # Compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    </IfModule>

    # Cache pour les fichiers statiques
    <LocationMatch "^/public/">
        Header set Cache-Control "max-age=2592000, public"
    </LocationMatch>
</VirtualHost>

# Configuration HTTPS (après avoir installé SSL avec Certbot)
# <VirtualHost *:443>
#     ServerName votre-domaine.com
#     ServerAlias www.votre-domaine.com
#     ServerAdmin admin@votre-domaine.com
#
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile /etc/letsencrypt/live/votre-domaine.com/fullchain.pem
#     SSLCertificateKeyFile /etc/letsencrypt/live/votre-domaine.com/privkey.pem
#     Include /etc/letsencrypt/options-ssl-apache.conf
#
#     # Même configuration proxy que ci-dessus
#     ProxyPreserveHost On
#     ProxyPass / http://localhost:3000/
#     ProxyPassReverse / http://localhost:3000/
#
#     # Support WebSocket
#     RewriteEngine On
#     RewriteCond %{HTTP:Upgrade} =websocket [NC]
#     RewriteRule /(.*)           wss://localhost:3000/$1 [P,L]
#     RewriteCond %{HTTP:Upgrade} !=websocket [NC]
#     RewriteRule /(.*)           http://localhost:3000/$1 [P,L]
#
#     # Logs
#     ErrorLog ${APACHE_LOG_DIR}/tarot-game-ssl-error.log
#     CustomLog ${APACHE_LOG_DIR}/tarot-game-ssl-access.log combined
# </VirtualHost>
